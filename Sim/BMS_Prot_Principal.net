* C:\Users\lenovo\Documentos\Sensoria\Sim\BMS_Prot_Principal.asc
V1 BAT+ 0 48
V2 V_DRV 0 11
V3 CMD_CHG 0 PWL(0 1 1.2 1 1.2001 0 2 0)
V4 CMD_DSG 0 PWL(0 0 1.2 0 1.2001 1 2 1)
M1 N003 D_GATE PACK+ PACK+ BSC160N10NS3
M2 N003 C_GATE N001 N001 BSC160N10NS3
C1 N002 N001 0.1µ
C2 PACK+ N002 0.1µ
R1 CHG C_GATE 5.1k
D1 N001 C_GATE MMBZ16VALY
R2 C_GATE N001 10Meg
D2 PACK+ D_GATE MMBZ16VALY
R3 D_GATE PACK+ 10Meg
R4 D_GATE DSG 5.1k
R5 PACK+ PACK 10k
R6 PACK+ LD 10k
C3 PACK+ N005 0.1µ
C4 N005 SRP 0.1µ
S1 CHG BAT+ INV_EN_CHG 0 SW_CHG_EN
S2 DSG LD INV_EN_DSG 0 SW_DSG_EN
S3 CHG_DRV CHG EN_CHG 0 SW_CHG_INV_EN
S4 DSG_DRV DSG EN_DSG 0 SW_DSG_INV_EN
S5 PACK+ N007 EN_CHG 0 SW_CHARGE
S6 PACK+ N009 EN_DSG 0 SW_LOAD
B2 CHG_DRV BAT+ V=V(V_DRV)
B4 DSG_DRV BAT+ V=V(V_DRV)
B6 EN_CHG 0 V={ if( (V(CMD_CHG) > 0.5) & V(FAULT_OCC) < 1, 1, 0) }
B7 EN_DSG 0 V={if((V(CMD_DSG) > 0.5) & V(FAULT_OCD) < 1 , 1, 0) }
A1 EN_DSG 0 0 0 0 INV_EN_DSG 0 0 BUF
A2 EN_CHG 0 0 0 0 INV_EN_CHG 0 0 BUF
D3 PACK+ N004 MMBZ16VALY
R9 N004 PACK+ 10Meg
R10 N004 N006 10k
D4 SRP N006 MMSD4148
R11 D_GATE N008 10k
M3 D_GATE N004 PACK+ PACK+ BSC160N10NS3
D5 0 DSG UDZLV100
D6 N008 DSG UDZLV100
D7 0 PACK UDZLV100
D8 0 LD UDZLV100
S7 N014 TRIP_OCD V_CURR 0 SWOCD
V6 N014 0 1
R8 TRIP_OCD 0 100k
A3 TRIP_OCD 0 0 0 0 nTRIP_OCD 0 0 BUF
R12 nTRIP_OCD 0 100k
B1 DELAY_OCD 0 V= idt(V(trip_ocd)/TTRIP, 0, V(trip_ocd) < 0.5)
S8 DELAY_OCD N010 DELAY_OCD 0 SWLATCH
R13 N010 0 10k
A4 N010 N012 0 0 0 0 FAULT_OCD 0 SRFLOP
B3 nDELAY_OCD 0 V= idt(V(ntrip_ocd)/TTRIP, 0, V(ntrip_ocd) < 0.5)
S9 nDELAY_OCD N012 nDELAY_OCD 0 SWLATCH
R14 N012 0 10k
R_SHUNT SRP 0 1m
B5 V_CURR 0 V= (V(SRP) - V(0))
S10 N015 TRIP_OCC 0 V_CURR SWOCC
V7 N015 0 1
R15 TRIP_OCC 0 100k
A5 TRIP_OCC 0 0 0 0 nTRIP_OCC 0 0 BUF
R16 nTRIP_OCC 0 100k
B8 DELAY_OCC 0 V= idt(V(trip_occ)/TTRIP, 0, V(trip_occ) < 0.5)
S11 DELAY_OCC N011 DELAY_OCC 0 SWLATCH
R17 N011 0 10k
A6 N011 N013 0 0 0 0 FAULT_OCC 0 SRFLOP
B9 nDELAY_OCC 0 V= idt(V(ntrip_occ)/TTRIP, 0, V(ntrip_occ) < 0.5)
S12 nDELAY_OCC N013 nDELAY_OCC 0 SWLATCH
R18 N013 0 10k
XX1 N007 SRP carregador_bat params: Vdc_charger={V_CHARGER} Vrip_pp={VRIP} f_ripp = {F_RIP} R_out= {ROUT} L_out = {LOUT}
R19 N001 BAT+ 0.4m
XX2 N009 SRP carga_bat params: MODE = {Load_Type} R_LOAD = {R_Carga} R_ESR_C = {R_Cap_Serie} C_LOAD = {Cap} R_ESR_L = {R_Ind_Serie} L_LOAD = {Ind} V_INIT = {V_Cap_Init}

* block symbol definitions
.subckt carregador_bat V+ V-
V2 N001 V- SINE({Vdc_charger} {Vrip_pp/2} { f_ripp} 0 0 0)
R1 N002 N001 {R_out}
L1 V+ N002 {L_out}
.ends carregador_bat

.subckt carga_bat V+ V-
R1 N005 V+ 1
L1 N001 N005 1µ
R2 N006 V- {R_LOAD}
S1 N001 N006 Res_Load 0 SW_SELECT
S2 N001 N003 Cap_Load 0 SW_SELECT
S3 N001 N002 Ind_Load 0 SW_SELECT
R3 N003 N007 {R_ESR_C}
C1 N007 V- {C_LOAD} IC={V_INIT}
R4 N002 N004 {R_ESR_L}
L2 N004 V- {L_LOAD}
B1 Res_Load 0 V=if({MODE}==0, 1,0)
B2 Cap_Load 0 V=if({MODE}==1, 1,0)
B3 Ind_Load 0 V=if({MODE}==2, 1,0)
.model SW_SELECT SW(Ron=1u Roff=1e9 Vt=0.5 Vh=0)
.ends carga_bat

.model D D
.lib C:\Users\lenovo\AppData\Local\LTspice\lib\cmp\standard.dio
.model NMOS NMOS
.model PMOS PMOS
.lib C:\Users\lenovo\AppData\Local\LTspice\lib\cmp\standard.mos
.model SW_CHG_EN SW(Ron=50 Roff=1e9 Vt=0.5 Vh=0)
.model SW_DSG_EN SW(Ron=50 Roff=1e9 Vt=0.5 Vh=0)
.model SW_CHG_INV_EN SW(Ron=1 Roff=1e9 Vt=0.5 Vh=0)
.model SW_DSG_INV_EN SW(Ron=1 Roff=1e9 Vt=0.5 Vh=0)
.model SW_LOAD SW(Ron=1m Roff=1e9 Vt=0.5 Vh=0)
.tran 0 2 1m 50u
* Chaveamentos
.model SW_CHARGE SW(Ron=1u Roff=1e9 Vt=0.5 Vh=0)
* Tensões DC
* Sinais de comando
* Sinais de acionamento dos pinos de gate
.model SWOCD SW(Ron=1 Roff=1e9 Vt={VTH} Vh={VH})
.param TTRIP = 500m
.model SWLATCH SW(Ron=1 Roff=1e9 Vt=1 Vh=0)
.param ITRIP=24
.model SWLATCH SW(Ron=1 Roff=1e9 Vt=1 Vh=0)
.model SWOCC SW(Ron=1 Roff=1e9 Vt={VTH} Vh={Vh})
* Lógica de detecção de limiar de corrente
.param VTH= 1m*ITRIP
.param VH=0
* Temporização da detecção do limiar de corrente em descarga
* Temporização da detecção do limiar de corrente em descarga
* Tensão sobre o resistor shunt
.param V_CHARGER=50 VRIP=2
.param Load_Type=1
.param R_Carga = 2 R_Cap_Serie = 50m Cap=500m
.param F_RIP = 120 ROUT=50m
.param LOUT=150u
.param R_Ind_Serie = 50m Ind = 500m
.param V_Cap_Init = 0
.step param Cap  list 10u 50u 200u 1m
.backanno
.end
